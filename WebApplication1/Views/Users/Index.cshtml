@* @model List<MiTabla> *@
@model List<WebApplication1.Models.Usuario>

<h1> Usuarios</h1>

@* <button onclick="fetchAndInsertUsers()">Fetch And Insert Users</button>
 *@
<table class="table">
    <thead>
        <tr>
            <th>Name</th>
            <th>Username</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Website</th>
@*             <th>Street</th>
            <th>Suite</th>
            <th>City</th>
            <th>Zipcode</th>
            <th>Lat</th>
            <th>Lng</th>
            <th>Company Name</th>
            <th>Catch Phrase</th>
            <th>Bs</th> *@
            <th>Actions</th> 
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                @* <td>
                    <span class="display" onclick="editName(this, @item.Id)">@item.Name</span>
                    <input type="text" class="edit" value="@item.Name" onblur="saveName(this, @item.Id)" style="display:none;" />
                </td> *@
                <td>@Html.DisplayFor(x => item.Name)</td>
                <td>@Html.DisplayFor(x => item.Username)</td>
                <td>@Html.DisplayFor(x => item.Email)</td>
                <td>@Html.DisplayFor(x => item.Phone)</td>
                <td>@Html.DisplayFor(x => item.Website)</td>
@*              <td>@Html.DisplayFor(x => item.Direccion.Street)</td>
                <td>@Html.DisplayFor(x => item.Direccion.Suite)</td>
                <td>@Html.DisplayFor(x => item.Direccion.City)</td>
                <td>@Html.DisplayFor(x => item.Direccion.Zipcode)</td>
                <td>@Html.DisplayFor(x => item.Direccion.Geo.Lat)</td>
                <td>@Html.DisplayFor(x => item.Direccion.Geo.Lng)</td>
                <td>@Html.DisplayFor(x => item.Compania.Name)</td>
                <td>@Html.DisplayFor(x => item.Compania.CatchPhrase)</td>
                <td>@Html.DisplayFor(x => item.Compania.Bs)</td> *@
                <td>
                    <a asp-controller="Users"
                       asp-action="Editar"
                       asp-route-id="@item.Id"
                       class="btn btn-primary">
                        Editar
                    </a>
                    <a asp-controller="Users"
                       asp-action="Eliminar"
                       asp-route-id="@item.Id"
                       onclick="return confirmarBorrado()"
                       class="btn btn-danger">
                        Eliminar
                    </a>
                </td>
            </tr>
        }
    </tbody>
</table>

@section Scripts{
    <script>
        async function fetchAndInsertUsers() {
            try {
                const response = await fetch('/api/users/fetch-and-insert', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    console.log('Users fetched and inserted successfully:', data);
                } else {
                    console.error('Failed to fetch and insert users:', response.status, response.statusText);
                }
            } catch (error) {
                console.error('Error fetching and inserting users:', error);
            }
        }

        function confirmarBorrado() { 
            return confirm("Esta seguro de eliminar el usuario?");
        } 
    </script>
}